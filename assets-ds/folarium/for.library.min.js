function no_order(a) {
    var b = a.length;
    if (1 == b)
        var c = "000000" + a;
    2 == b && (c = "00000" + a);
    3 == b && (c = "0000" + a);
    4 == b && (c = "000" + a);
    5 == b && (c = "00" + a);
    6 == b && (c = "0" + a);
    7 == b && (c = a);
    0 == b && (c = "0000001");
    return c
}
function urlset(param) {
    return param.trim().replace(/:| /gi, "-").toLowerCase();
}
function numberToCurrency(a) {
    if ("" != a && null != a) {
        a = a.toString();
        a = a.replace(/[^\d\,]/g, "").split(",");
        for (var b = "", c = 0, d = a[0].length; 0 < d; d--)
            c += 1, b = 1 == c % 3 && 1 != c ? a[0].substr(d - 1, 1) + "." + b : a[0].substr(d - 1, 1) + b;
        1 < a.length && (b = 0 < a[1].length ? b + ("," + a[1]) : b + ",");
        return b
    }
    return""
}
function format_num(a) {
    a.value = numberToCurrency(a.value)
}
function number(a) {
    a.value = parseNumber(a.value)
}
function parseNumber(a) {
    if ("" != a && null != a) {
        a = a.toString();
        a = a.replace(/[^\d\,]/g, "").split(",");
        for (var b = "", c = a[0].length; 0 < c; c--)
            b = a[0].substr(c - 1, 1) + b;
        1 < a.length && (b = 0 < a[1].length ? b + ("," + a[1]) : b + ",");
        return b
    }
    return"";
}
function komaKeTitik(a) {
    a = a.toString();
    var b = "";
    null != a && (b = a.replace(/\,/g, "."));
    return b
}
function currencyToNumber(a) {
    var b = a.toString(), c = "";
    if (null != a || "" != a)
        c = b.replace(/\.+/g, "");
    return parseFloat(komaKeTitik(c))
}
function numberToCurrency2(a) {
    if (null == a || isNaN(a))
        return"";
    a = parseInt(a).toString();
    for (var b = "", c = 0, d = a.length; 0 < d; d--)
        c += 1, b = 1 == c % 3 && 1 != c ? a.substr(d - 1, 1) + "." + b : a.substr(d - 1, 1) + b;
    return b
}
function floatToCurrency(a) {
    if ("" != a && null != a) {
        a = a.toString();
        var b = a.replace(/[^\d\.]/g, "");
        a = a.split(".");
        return 1 < a.length ? (b = a[1].substr(0, 2), numberToCurrency2(a[0]) + "," + b) : numberToCurrency2(b)
    }
    return""
}
$(".logout").click(function () {
    $(this).each(function () {

        swal({
            title: "Folarium Maintenance System",
            text: "Do you want to log out of the system ?",
            type: "warning",
            showCancelButton: true,
            confirmButtonClass: "btn-danger",
            confirmButtonText: "Yes, Logout Me!",
            closeOnConfirm: false,
            showLoaderOnConfirm: true
        },
                function () {
                    setTimeout(function () {
                        window.location.href = baseUrl + "logout"
                    }, 3000);

                });
    })
});
function adds_row_payment(md) {
    var counter = $('.row_tam').length + 1;
    var counterStrike = $('.add-new').length + 1;
    var counters = $('.row_out').length + 1;
    var baris = '<tr class="row_out row_outs add-new">'
            + '<td class="text-center"><p style="margin-top: 5px" class="nom_' + counters + '">' + counters + '</p></td>'
            + '<td><input type="hidden" name="dt_menu[]" value="' + md + '"><input type="text" name="note_menu[]" value="Lainnya" class="form-control"></td>'
            + '<td>'
            + '<input type="text" readonly name="harga_add[]" onkeyup="calcPay(this, ' + counters + ')" id="price_' + counters + '" value="" class="form-control" placeholder="Harga">'
            + '</td>'
            + '<td>'
            + '<input type="text" onkeyup="calcPay(this, ' + counters + ')" name="qty_menu[]" id="qty_' + counters + '" value="1" class="form-control" placeholder="Qty">'
            + '</td>'
            + '<td class="text-right total_' + counters + '">Rp 0,-</td>'
            + '<td class="text-right"><input type="hidden" name="total_add[]" id="total_add_' + counters + '" value="" class="form-control">'
            + '<center><button type="button" class="btn btn-sm btn-danger" id="btn_' + counters + '" onclick="cut_payment(this, ' + counters + ')"><i class="fa fa-times"></i></button>'
            + '</center></td>'
            + '</tr>';
    $('.detail_order').append(baris);
}
function cut_payment(el, i) {
    var rowx = $('.row_out').length;
    for (var ax = (i - 1); ax < rowx; ax++) {
        var roc = ax + 1;
        $(".nom_" + roc).html(ax);
        $(".nom_" + roc).attr('class', "nom_" + ax);
        $("#menu_select_" + roc).attr('id', "menu_select_" + ax);
        $("#btn_" + roc).attr('onclick', "cut_payment(this, " + ax + ")");
        $("#menu_" + roc).attr('onchange', "menusa(this," + ax + ")");
        $("#menu_" + roc).attr('id', "menu_" + ax);
        $("#menu-type-" + roc).attr('id', "menu-type-" + ax);
        $("#btn_" + roc).attr('id', "btn_" + ax);
        $(".total_" + roc).attr('class', "text-right total_" + ax);
        $("#total_add_" + roc).attr('id', "total_add_" + ax);
        $("#price_" + roc).attr('onkeyup', "calcPay(this, " + ax + ")");
        $("#price_" + roc).attr('id', "price_" + ax);
        $("#disc_" + roc).attr("onkeyup", "calcPay(this, " + ax + ")");
        $("#disc_" + roc).attr("id", "disc_" + ax);
        $("#compliment_" + roc).attr("id", "compliment_" + ax);
        $("#clt_reason_" + roc).attr("id", "clt_reason_" + ax);
        $("#qty_" + roc).attr('onkeyup', "calcPay(this, " + ax + ")");
        $("#qty_" + roc).attr('id', "qty_" + ax);
        $("#btn_" + roc + "_1").attr('onclick', "status_compliment(1, " + ax + ")");
        $("#btn_" + roc + "_1").attr('id', "btn_" + ax + "_1");
        $("#btn_" + roc + "_2").attr('onclick', "status_compliment(2, " + ax + ")");
        $("#btn_" + roc + "_2").attr('id', "btn_" + ax + "_2");
    }
    var parent = el.parentNode.parentNode.parentNode;
    parent.parentNode.removeChild(parent);
    var menu_order_id = $("#menu_order_id").val();
    calcPayNew();
}
function status_antar_payment(x) {
    if (x != '') {
        if (x == 'belum') {
            return '<div style="background : #f0ad4e; border-color: #eea236;color: white; padding: 4px; font-size: 12px; margin: 0px"><i class="fa fa-minus-circle mg-r-sm mg-l-md"></i>Belum Diantar</div>';
        } else if (x == 1) {
            return '<div style="background : #5cb85c; border-color: #4cae4c;color: white; padding: 4px; font-size: 12px; margin: 0px"><i class="fa fa-check mg-r-sm"></i>Sudah Diantar</div>';
        } else if (x == 2) {
            return '<div style="background : #d9534f; border-color: #d43f3a; color: white; padding: 4px; font-size: 12px; margin: 0px"><i class="fa fa-minus-circle mg-r-sm"></i>Batal</div>';
        }
    }
}
function status_compliment(status, numb) {
    $('.bs-modal-sm').modal('show');
    $("#modal-content").load(baseUrl + "payment/pay/cancel/compliment/" + numb + "/" + status);
    return false;
}
function status_paid_cancel(status, numb) {
    $('.bs-modal-sm').modal('show');
    $("#modal-content").load(baseUrl + "payment/pay/cancel/orders/" + numb + "/" + status);
    return false;
}
function adds_row_payment_select() {
    var counterStrike = $('.add-new').length + 1;
    var counters = $('.row_out').length + 1;
    var counterss = $('.row_tam').length + 1;
    var rowss = $('.row_out').length + 1;
    for (var a = rowss; a >= counterss; a--) {
        var rz = a + 1;
        $(".nom_" + a).html(rz);
        $(".nom_" + a).attr('class', "nom_" + rz);
        $("#menu_select_" + a).attr('id', "menu_select_" + rz);
        $("#btn_" + a).attr('onclick', "cut_payment(this, " + rz + ")");
        $("#menu_" + a).attr('onchange', "menusa(this," + rz + ")");
        $("#menu_" + a).attr('id', "menu_" + rz);
        $("#menu-type-" + a).attr('id', "menu-type-" + rz);
        $("#btn_" + a).attr('id', "btn_" + rz);
        $(".total_" + a).attr('class', "text-right total_" + rz);
        $("#total_add_" + a).attr('id', "total_add_" + rz);
        $("#price_" + a).attr('onkeyup', "calcPay(this, " + rz + ")");
        $("#price_" + a).attr('id', "price_" + rz);
        $("#disc_" + a).attr("onkeyup", "calcPay(this, " + rz + ")");
        $("#disc_" + a).attr("id", "disc_" + rz);
        $("#compliment_" + a).attr("id", "compliment_" + rz);
        $("#clt_reason_" + a).attr("id", "clt_reason_" + rz);
        $("#qty_" + a).attr('onkeyup', "calcPay(this, " + rz + ")");
        $("#qty_" + a).attr('id', "qty_" + rz);
        $("#btn_" + a + "_1").attr('onclick', "status_compliment(1, " + rz + ")");
        $("#btn_" + a + "_1").attr('id', "btn_" + rz + "_1");
        $("#btn_" + a + "_2").attr('onclick', "status_compliment(2, " + rz + ")");
        $("#btn_" + a + "_2").attr('id', "btn_" + rz + "_2");

    }
    var baris = '<tr class="row_out row_tam add-new">'
            + '<td class="text-center"><p style="margin-top: 5px" class="nom_' + counterss + '">' + counterss + '</p></td>'
            + '<td id="menu_select_' + counterss + '"></td>'
            + '<td>'
            + '<input type="text" readonly name="harga_add[]" onkeyup="calcPay(this, ' + counterss + ')" id="price_' + counterss + '" value="" class="form-control" placeholder="Harga">'
            + '</td>'
            + '<td>'
            + '<input type="hidden" name="note_menu[]" value="">'
            + '<input type="text" onkeyup="calcPay(this, ' + counterss + ')" name="qty_menu[]" id="qty_' + counterss + '" value="1" class="form-control" placeholder="Qty">'
            + '</td>'
            + '<td class="text-right total_' + counterss + '">Rp 0,-</td>'
            + '<td style="width: 40px">'
            + '<input type="hidden" name="clt_reason_add[]" id="clt_reason_' + counterss + '" value=""/>'
            + '<input type="hidden" id="menu-type-' + counterss + '" value="0"/>'
            + '<input type="hidden" name="compliment_add[]" id="compliment_' + counterss + '" value="1"/>'
            + '<button style="display: block" type="button" class="btn btn-sm btn-success" onclick="status_compliment(1,' + counterss + ')" id="btn_' + counterss + '_1" data-toggle="tooltip" data-placement="left" title="Compliment"><i class="fa fa-random"></i></button>'
            + '<button style="display: none" type="button" class="btn btn-sm btn-warning" onclick="status_compliment(2,' + counterss + ')" id="btn_' + counterss + '_2" data-toggle="tooltip" data-placement="left" title="Berbayar"><i class="fa fa-refresh"></i></button>'
            + '</td>'
            + '<td class="text-right" style="width: 40px"><input type="hidden" name="total_add[]" id="total_add_' + counterss + '" value="" class="form-control">'
            + '<center><button type="button" class="btn btn-sm btn-danger" id="btn_' + counterss + '" onclick="cut_payment(this, ' + counterss + ')"><i class="fa fa-times"></i></button>'
            + '</center></td>'
            + '</tr>';
    $('.detail_tambahan').append(baris);
    $('#menu_select_' + counterss).load(baseUrl + "payments/get-menu/" + counterss);
}
function menusa(el, ctrs) {

    var id = $("#menu_" + ctrs + " option:selected").val();
    var rowx = $('.row_out').length;
    var duplicate = 0;
    for (var axa = 1; axa <= rowx; axa++) {
        if ($("#menu_" + axa).val() == id) {
            duplicate += 1;
        }
    }
    if (duplicate > 1) {
        bootbox.alert("<i class='fa fa-info-circle mg-r-md'></i>Duplikasi barang <b>" + $("#menu_" + ctrs + " option:selected").attr('item') + "</b> tidak diperbolehkan, silahkan jadikan 1 penjualan !", function (result) {
            for (var ax = (ctrs - 1); ax < rowx; ax++) {
                var roc = ax + 1;
                $(".nom_" + roc).html(ax);
                $(".nom_" + roc).attr('class', "nom_" + ax);
                $("#menu_select_" + roc).attr('id', "menu_select_" + ax);
                $("#btn_" + roc).attr('onclick', "cut(this, " + ax + ")");
                $("#menu_" + roc).attr('onchange', "menusa(this," + ax + ")");
                $("#menu_" + roc).attr('id', "menu_" + ax);
                $("#menu-type-" + roc).attr('id', "menu-type-" + ax);
                $("#btn_" + roc).attr('id', "btn_" + ax);
                $(".total_" + roc).attr('class', "text-right total_" + ax);
                $("#total_add_" + roc).attr('id', "total_add_" + ax);
                $("#price_" + roc).attr('onkeyup', "calcPay(this, " + ax + ")");
                $("#price_" + roc).attr('id', "price_" + ax);
                $("#disc_" + roc).attr("onkeyup", "calcPay(this, " + ax + ")");
                $("#disc_" + roc).attr("id", "disc_" + ax);
                $("#compliment_" + roc).attr("id", "compliment_" + ax);
                $("#clt_reason_" + roc).attr("id", "clt_reason_" + ax);
                $("#qty_" + roc).attr('onkeyup', "calcPay(this, " + ax + ")");
                $("#qty_" + roc).attr('id', "qty_" + ax);
            }
            var parent = el.parentNode.parentNode;
            parent.parentNode.removeChild(parent);
            calcPayNew();
            adds_row_payment_select();
        });
        return false;
    }
    if (ctrs == rowx) {
        adds_row_payment_select();
    }
    $.ajax({
        url: baseUrl + "payments/get-menu-price/" + id,
        dataType: "JSON",
        success: function (json) {
            $("#price_" + ctrs).val(numberToCurrency(json.price));
            var disc = currencyToNumber($("#disc_" + ctrs).val() ? $("#disc_" + ctrs).val() : 0);
            var jumlah = currencyToNumber(!$("#qty_" + ctrs).val() ? '0' : $("#qty_" + ctrs).val());
            $(".total_" + ctrs).html("Rp " + numberToCurrency((json.price - ((disc / 100) * json.price)) * jumlah)) + ",-";
            $("#total_add_" + ctrs).val((json.price - ((disc / 100) * json.price)) * jumlah);
            $("#menu-type-" + ctrs).val(json.type);
            calcPayNew();
        }
    });

}

function calcPayNew() {
    var drink_type = 0;
    var food_type = 0;
    var drink_type_total = 0;
    var food_type_total = 0;
    var drink_type_total_disc = 0;
    var food_type_total_disc = 0;
    for (var a = $(".row_out").length, b = 0, d = 1; d <= a; d++) {
        if ($("#compliment_" + d).val() == 1) {
            var c = 0;
            if (!$("#disc_" + (d)).val() || $("#disc_" + (d)).val() == 0) {
                c = currencyToNumber($("#total_add_" + d).val() ? $("#total_add_" + d).val() : 0);
                b = b + c;
            } else {
                b = b + currencyToNumber($("#total_add_" + d).val() ? $("#total_add_" + d).val() : 0);
            }
            if (!$("#disc_" + (d)).val() || $("#disc_" + (d)).val() == 0) {
                if ($("#menu-type-" + (d)).val() == 1) {
                    food_type += 1;
                    food_type_total += c;
                }
                if ($("#menu-type-" + (d)).val() == 2) {
                    drink_type += 1;
                    drink_type_total += c;
                }
            } else {
                if ($("#menu-type-" + (d)).val() == 1) {
                    food_type_total += c;
                }
                if ($("#menu-type-" + (d)).val() == 2) {
                    drink_type_total += c;
                }
            }
        }
    }
    if (food_type > 0) {
        $("select#payment-disc-set").removeAttr("disabled", "disabled");
    } else {
        $("#payment-disc-set").find('option').each(function (i, opt) {
            $(opt).removeAttr('selected', 'selected');
            if (opt.value == '0') {
                $(opt).attr('selected', 'selected');
            }
        });
        $("select#payment-disc-set").attr("disabled", "disabled");
    }
    if (drink_type > 0) {
        $("select#payment-disc-drink-set").removeAttr("disabled", "disabled");
    } else {
        $("#payment-disc-drink-set").find('option').each(function (i, opt) {
            $(opt).removeAttr('selected', 'selected');
            if (opt.value == '0') {
                $(opt).attr('selected', 'selected');
            }
        });
        $("select#payment-disc-drink-set").attr("disabled", "disabled");

    }
    $(".sub_total").val("" + (b + food_type_total_disc + drink_type_total_disc) + "");
    $(".total_sub").val(numberToCurrency2("" + (b + food_type_total_disc + drink_type_total_disc) + ""));
    var food_srv = ($("input[name=persen_service]").val() ? (($("input[name=persen_service]").val() / 100) * food_type_total) : 0);
    var drink_srv = ($("input[name=persen_service]").val() ? (($("input[name=persen_service]").val() / 100) * drink_type_total) : 0);
    var total_food_srv = (food_type_total + food_srv);
    var total_drink_srv = (drink_type_total + drink_srv);

//------------discount food
    var disc_opr = $("select[name=pay_disc] option:selected").attr('data-param');
    var discount = !$("select[name=pay_disc] option:selected").attr('data-disc') ? 0 : $("select[name=pay_disc] option:selected").attr('data-disc');
    var disc_nominal = (disc_opr == "nominal" ? discount : (discount / 100) * total_food_srv);
    $("input[name=disc_cvt]").val(numberToCurrency2(disc_nominal));
//------------discount drink    
    var disc_opr_drink = $("select[name=pay_disc_drink] option:selected").attr('data-param');
    var discount_drink = !$("select[name=pay_disc_drink] option:selected").attr('data-disc') ? 0 : $("select[name=pay_disc_drink] option:selected").attr('data-disc');
    var disc_nominal_drink = (disc_opr_drink == "nominal" ? discount_drink : (discount_drink / 100) * total_drink_srv);
    $("input[name=disc_cvt_drink]").val(numberToCurrency2(disc_nominal_drink));

    var total_sub_serv_disc = (b - disc_nominal - disc_nominal_drink);


    var tax = currencyToNumber($(".tax").val());
    var tax_nominal = (tax / 100) * total_sub_serv_disc;


    $(".tax-nominal").val(numberToCurrency2(tax_nominal));
    $(".service").val(numberToCurrency2(drink_srv + food_srv));
    var voucher = $("select[name=pay_disc_ep] option:selected").val();
    var voucher_nominal = 0;
    if (voucher != '0') {
        var disc_set_ep = $("input[name=ep_disc_percent]").val();
        if (disc_set_ep == 0) {
            var voucher_used = currencyToNumber(!$("input[name=disc_cvt_ep]").val() ? 0 : $("input[name=disc_cvt_ep]").val());
            var voucher_rest = $("select[name=pay_disc_ep] option:selected").attr("data-limit-monthly");
            if ((total_sub_serv_disc + tax_nominal) < voucher_used) {
                bootbox.alert("<i class='fa fa-info-circle mg-r-md'></i>Jumlah voucher tidak boleh lebih dari total tagihan !");
                $("input[name=disc_cvt_ep]").val("");
            } else {
                if (voucher_used > voucher_rest) {
                    bootbox.alert("<i class='fa fa-info-circle mg-r-md'></i>Jumlah voucher yang digunakan tidak boleh lebih dari sisa voucher tersedia !");
                    $("input[name=disc_cvt_ep]").val("");
                } else {
                    voucher_nominal = voucher_used;
                }
            }
        } else {
            voucher_nominal = ((disc_set_ep / 100) * total_sub_serv_disc);
            $("input[name=disc_cvt_ep]").val(numberToCurrency2(voucher_nominal));
        }
    }
    var total_sub_serv_disc_tax = total_sub_serv_disc + tax_nominal - voucher_nominal;
    $(".total").val(numberToCurrency2(total_sub_serv_disc_tax));

    $("input[name=jumlah_bayar]").val("");
    if ($("select[name=pay_method] option:selected").attr('data-formula') == 2) {
        $("input[name=jumlah_bayar]").val(numberToCurrency2(total_sub_serv_disc_tax));
    }
    $(".kembali").val(0);
    $(".kekurangan").val(0);
}